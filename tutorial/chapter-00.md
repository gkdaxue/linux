# 计算机存储设备(机械硬盘)

## 物理组成

硬盘是由很多的盘片, 机械手臂, 磁头以及转轴马达所组成的,内部结构如图0-0所示
![机械硬盘物理构造](https://github.com/gkdaxue/linux/raw/master/image/chapter_00.png)

机械手臂构造如图0-1所示
![机械手臂构造](https://github.com/gkdaxue/linux/raw/master/image/chapter_01.png)

## 工作原理

    主轴马达带动盘片转动,然后机械手臂可伸展让磁头(读取头)在盘片上进行读写操作,读写主要通过机械臂上的读取头来操作,而实际的数据就是写在具有磁性物质的盘片上,单一的盘片容量有限, 因此有些容量比较大的硬盘会有很多盘片.

## 物理结构

    磁盘的物理结构如图0-2所示
![磁盘物理结构分析](https://github.com/gkdaxue/linux/raw/master/image/chapter_02.png)    

### 盘片(Platter)

    一块硬盘有若干盘片，每个盘片有可以存储数据的上、下两盘面/磁面(Side), 这些盘面堆叠在主轴上高速旋转，它们从上至下从“0”开始依次编号

### 磁头(Head)

    每个盘片的每个有效的盘面都会有一个磁头(Read/Write head), `磁头数 = 盘面数 = 盘片个数 * 2` . 由于磁头工作的性质，对磁感应的要求非常高。磁头是在高速旋转的盘片上悬浮的，悬浮力来自盘片旋转带动的气流，磁头必须悬浮而不是接触盘面，避免盘面和磁头发生相互接触造成磨损

### 磁道(Track)

    当盘片旋转时，磁头若保持在一个位置上，则每个磁头都会在磁盘表面划出一个圆形轨迹，这些圆形轨迹就叫做磁道.(磁道是一个同心圆环而不是一个同心圆,为了方便描述, 所以画成了圆环,扇区组成一个圆就是磁道) **磁道从外向内从0开始顺序编号**

### 扇区(Sector)

    将一个盘面划分为若干内角相同的扇形，这样盘面上的每个磁道就被分为若干段圆弧，每段圆弧叫做一个扇区(外围磁道上的扇区数量要大于内圈的磁道,所以数据的读写默认是由外圈往内圈操作).每个扇区可以存放512个字节的信息.（相邻两个磁道或扇区之间都留有一定间隙，以避免精度问题造成故障） **磁盘的最小物理存储单位**

### 柱面(Cylinder)

    每个盘面都被划分为数目相等的磁道，并从外缘的“0”开始编号，具有相同编号的磁道形成一个圆柱，称之为磁盘的柱面。磁盘的柱面数与一个盘单面上的磁道数是相等的。无论是双盘面还是单盘面，由于每个盘面都只有自己独一无二的磁头，因此，盘面数等于总的磁头数.所谓硬盘的CHS，即Cylinder（柱面）、Head（磁头）、Sector（扇区），只要知道了硬盘的CHS的数目，即可确定硬盘的容量，硬盘的容量=柱面数*磁头数*扇区数*512B。

## 磁盘传输接口

    目前磁盘与主机系统的连接主要有 `IDE接口` `SATA接口` `SCSI接口` 这三种传输接口规格

## 注意事项

    在GPT模式下,磁盘的分区通常使用扇区号码来划分, 而在MS-DOS中则是通过柱面号码来划分的(先做了解)

# Linux是什么

    Linux就是一个操作系统, 就是内核(Kernel)与系统调用(System Call)那两层. 操作系统知识在管理整个硬件信息, 包含CPU, 内存, 输入输出设备及系统文件等. 如图0-3所示
![操作系统的角色](https://github.com/gkdaxue/linux/raw/master/image/chapter_03.png)  

## 内核(Kernel)

    管理计算机的所有活动以及驱动系统中的所有硬件, 管理硬件以及提供合理的计算机系统资源分配(CPU, 内存等). (只有内核提供的功能, 你的系统才能帮你完成)    

    内核的功能主要有: `提供系统调用接口` `程序管理` `内存管理` `文件系统管理` `设备驱动`等 

### 内核版本

    内核也是软件, 所以也是在不断的升级中, 所以也是有不同的版本. 可以通过 `uname -r` 命令来进行查看.  如 `2.6.32-696.el6.x86_64`
    表示的含义为 : **主版本.次版本.发布版本-修订版本.操作系统版本(el6 Centos 6).CPU架构(64位)**

```
    主次版本为奇数 : 开发中版本(development)
    主次版本为偶数 : 稳定版本(stable)
```

## 系统调用(System Call)

    为了保护内核, 操作系统通常会提供一整组开发接口. 应用程序则是根据操作系统提供的开发接口来运行的. 由此可见软件/硬件都与内核有很大的关系, 而与用户相关的则是应用程序了. 

## 硬件设备命令规则

    在Linux中有一个很重要的概念 : ` Linux系统中, 一切皆文件` , 那么都是文件, 系统是怎么识别哪些文件是硬盘, 鼠标这些呢, 这就需要用到我们讲解的命名规则, 举例来说 : `SATA接口的硬盘文件名为/dev/sd[a-p]`, **几乎所有的硬件设备文件都在/dev这个目录中**

> `[a-p]` : 中括号中 a-p 表示 a-p 当中的任意一个,  如/dev/sda, /dev/sdb, /dev/sdc 等

| 设备                        | Linux中的文件名                                                                       |
|:------------------------- |:-------------------------------------------------------------------------------- |
| IDE 硬盘                    | /dev/hd\[a-d\]                                                                   |
| SCSI / SATA / USB 硬盘 / U盘 | /dev/sd\[a-p\]                                                                   |
| Virtio 接口                 | /dev/vd\[a-p\]                                                                   |
| 软盘驱动器                     | /dev/fd\[0-7\]                                                                   |
| 打印机                       | /dev/lp\[0-2\] (25针打印机)<br>/dev/usb/lp\[0-15\] (USB接口)                           |
| 鼠标                        | /dev/psaux (ps/2接口)<br>/dev/usd/mouse\[0-15\] (USB)<br>/dev/mouse (当前鼠标)         |
| CD/DVD ROM                | /dev/cdrom (当前cd-rom) <br>/dev/sr\[0-1\] (通用 CentOS较常见) <br>/dev/scd\[0-1\] (通用) |
| 磁带机                       | /dev/ht0 (IDE接口)<br>/dev/st0 (SATA/SCSI接口)<br>/dev/tape (当前磁带)                   |

<center>表 0-0 Linux中硬件设备命名规则</center>

# 磁盘分区

    一个硬盘可以被分为多个分区(partition),  从window角度来看, 我们都知道可以分为C D E F 盘等等, 系统一般装在C盘, 但是`在Linux系统中一切皆文件` 那么分区的文件名是什么, 又该如何表示, 系统装在什么地方, 这就是我们接下来要讲解的重点.

个人计算机常见的磁盘接口为 `IDE` 和 `SATA` 这两种接口, 主流接口为`SATA接口` , 而我们从表 0-0 中可以知道 SATA 接口在Linux中设备名为 /dev/sd\[a-p\]这种形式, 那么如果我有两块硬盘 都插在了 SATA 接口中, 那么每个硬盘又是如何命名的呢?

> SATA / USB 接口的磁盘设备文件名根本就没有一定的顺序,  而是根据 **`Linux内核检测到磁盘的顺序来决定设备的文件名`** 

```
    比如我有两块SATA硬盘以及一个USB磁盘, 主板上面有六个SATA插槽,而SATA被插在SATA1, SATA5插槽上, 那么这三个磁盘在Linux中的设备文件名分别是什么?
    因为是根据检测到的顺序来对文件命名而不是实际插槽的顺序,由此可得
1. SATA1插槽 : /dev/sda
2. SATA5插槽 : /dev/sdb  (而不是/dev/sde,虽然在第5个插槽上, 但是是根据识别到的顺序)
3. USB磁盘   : /dev/sdc (开机完成后才被系统识别到)
```

## 磁盘的组成

磁盘主要由盘片, 机械臂, 磁头, 转轴马达组成. 盘片可以细分为 [扇区(Sector)](#扇区(Sector) 和 [柱面(Cylinder) ](#柱面(Cylinder) 两种单位, 每个扇区为 512bytes 大小

## 3

4
4
5
5
